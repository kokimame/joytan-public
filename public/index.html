<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Joytan Public</title>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/6.4.1/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/6.4.1/firebase-auth.js"></script>
  <script defer src="/__/firebase/6.4.1/firebase-database.js"></script>
  <script defer src="/__/firebase/6.4.1/firebase-messaging.js"></script>
  <script defer src="/__/firebase/6.4.1/firebase-storage.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="/__/firebase/init.js"></script>
  
  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <!-- For popup? -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

  <!-- For accordion -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">


  <script src="/js/addPlayer.js"></script>
  <script src="/js/addProject.js"></script>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/login.css">

  <script type="text/javascript">
    window.onload = () => {
      const storage = firebase.storage();
      const storageRef = storage.ref();
      const topProjectsRef = storageRef.child('projects');
      const structureRef = storageRef.child('projects_structure.json');
      var structureData;

      structureRef.getDownloadURL().then((url) => {
        $.getJSON(url, (data) => {
          loadProjects(data, topProjectsRef);
        })
      })
      $("#auth-form").click(function(ev){
        if(ev.target != this) {
          return;
        }
        $('#auth-form').hide()
      });
    }
    function loadProjects(structureJson, topRef) {
      topRef.listAll().then(res => {
        res.prefixes.forEach(projectRef => {
          addProject(structureJson[projectRef.name], projectRef);
        })
      })

    var password = document.getElementById("signup-psw")
    var confirmPsw = document.getElementById("confirm-password");

    function validatePassword(){
      if(password.value != confirmPsw.value) {
        confirmPsw.setCustomValidity("Passwords Don't Match");
      } else {
        confirmPsw.setCustomValidity('');
      }
    }
    password.onchange = validatePassword;
    confirmPsw.onkeyup = validatePassword
    }

    function createNewUser() {
      var password = $("#signup-psw").val()
      var email = $("#signup-email").val()
      //Create User with Email and Password
      firebase.auth().createUserWithEmailAndPassword(email, password).catch((error) => {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        console.log(errorCode);
        console.log(errorMessage);
      }).then(() => {
        console.log("Created new User!")
      });
    }
    function loginUser() {
      var password = $("#login-psw").val()
      var email = $("#login-email").val()
      //Sign In User with Email and Password
      firebase.auth().signInWithEmailAndPassword(email, password).catch((error) => {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        console.log(errorCode);
        console.log(errorMessage);
      });    
    }
  </script>

</head>

<body>
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="container">
        <h2 class="mt-2">Joytan Public <a class="fa fa-users" style="color: darkgreen; margin-left: 5px;"></a></h2>
        <p><b>Where we celebrate our special voice!</b> Please help us evaluate voice recordings for future language-teaching. 
          Your voice recordings sent through 
          <a href="https://play.google.com/store/apps/details?id=com.joytan.rec">Joytan-REC</a> (Android app)
           will immediately be available on this website!
        </p>

        <a href="https://www.youtube.com/c/JoytanApp" class="fa icon fa-youtube-play"></a>
        <a href="https://play.google.com/store/apps/details?id=com.joytan.rec" class="fa icon fa-android"></a>
        <a href="https://github.com/kokimame/joytan" class="fa icon fa-github"></a>
        <a href="https://twitter.com/JoytanApp" class="fa icon fa-twitter"></a>

        <button class="btn btn-success" onclick="document.getElementById('auth-form').style.display='block'" 
          style="width:auto;">Sign Up</button>

        <div id="auth-form" class="modal">
          <span onclick="document.getElementById('auth-form').style.display='none'" class="close" title="Close Modal">&times;</span>
          <div class="modal-content">
            <div class="modal-container container">
              <div id="signup-modal">
                <form>
                  <h2>Sign Up</h2>
                  <p>Have an account? <a href="#/" onclick="document.getElementById('signup-modal').style.display='none';
                    document.getElementById('login-modal').style.display='block'"><b>Log in!</b></a></p>
                  <hr>
                  <p>Please fill in this form to create an account.</p>
                  <label for="email"><b>Email</b></label>
                  <input id="signup-email" type="text" placeholder="Enter Email" name="email"> 
                    <!-- pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="For example, [a-Z]@[a-Z].domain" required> -->
            
                  <label for="psw"><b>Password</b></label>
                  <input id="signup-psw" type="password" placeholder="Enter Password" name="psw">
                    <!-- minlength="8" maxlength="15" required> -->
            
                  <label for="psw-repeat"><b>Repeat Password</b></label>
                  <input id="confirm-password" type="password" placeholder="Repeat Password" name="psw-repeat">
                   <!-- required> -->
    
                  <label for="psw-repeat"><b>User name</b></label>
                  <input id="signup-uname" type="text" placeholder="Enter your Username" name="username"> 
                    <!-- minlength="3" maxlength="32" required> -->
                  
                  <label>
                    <input type="checkbox" checked="checked" name="remember" style="margin-bottom:15px"> Remember me
                  </label>
            
                  <p>By creating an account you agree to our <a href="#" style="color:dodgerblue">Terms & Privacy</a>.</p>
            
                  <div class="clearfix">
                    <button class="modal-button cancel-btn" type="button" onclick="document.getElementById('auth-form').style.display='none'" >Cancel</button>
                    <button class="modal-button signup-btn"  type="button" onclick="createNewUser()">Sign Up</button>
                  </div>
                </form>
              </div>
              <div id="login-modal">
                <form method="post">
                  <h2>Log in</h2>
                  <p>Don't have an account? <a href="#/" onclick="document.getElementById('login-modal').style.display='none';
                    document.getElementById('signup-modal').style.display='block'"><b>Sign up!</b></a></p>
                  <hr>
                  <p>Please fill in this form to log in.</p>
                  <label for="email"><b>Email</b></label>
                  <input id="login-email" type="text" placeholder="Enter Email" name="email">
                    <!-- pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="For example, [a-Z]@[a-Z].domain" required> -->
            
                  <label for="psw"><b>Password</b></label>
                  <input id="login-psw" type="password" placeholder="Enter Password" name="psw" required>
                    <!-- minlength="8" maxlength="15" required> -->
  
                  <label>
                    <input type="checkbox" checked="checked" name="remember" style="margin-bottom:15px"> Remember me
                  </label>
            
                  <div class="clearfix">
                    <button class="modal-button cancel-btn" type="button" onclick="document.getElementById('auth-form').style.display='none'" >Cancel</button>
                    <button class="modal-button login-btn" type="button" onclick="loginUser()">Log in</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <hr />
        <div class="accordion" id="projectsTop">
        </div>
      </div>
    </div>


    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyBr9SLxhKfyxzsbVmCVcn-J_QCgHQOqrOY",
        authDomain: "joytan-rec-16ba2.firebaseapp.com",
        databaseURL: "https://joytan-rec-16ba2.firebaseio.com",
        projectId: "joytan-rec-16ba2",
        storageBucket: "joytan-rec-16ba2.appspot.com",
        messagingSenderId: "950782104164",
        appId: "1:950782104164:web:adccd0fa64ae91ac"
      };
      firebase.initializeApp(firebaseConfig);
    </script>
</body>

</html>
