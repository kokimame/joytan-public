<!DOCTYPE html>
<html>
<!--
 ‚ï¶‚ïî‚ïê‚ïó‚ï¶ ‚ï¶‚ïî‚ï¶‚ïó‚ïî‚ïê‚ïó‚ïî‚ïó‚ïî
 ‚ïë‚ïë ‚ïë‚ïö‚ï¶‚ïù ‚ïë ‚ï†‚ïê‚ï£‚ïë‚ïë‚ïë
‚ïö‚ïù‚ïö‚ïê‚ïù ‚ï©  ‚ï© ‚ï© ‚ï©‚ïù‚ïö‚ïù by Kohki Mametani
-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Joytan Public</title>
  <!-- update the version number as needed -->
  <script defer src="/__/firebase/7.6.1/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/7.6.1/firebase-auth.js"></script>
  <script defer src="/__/firebase/7.6.1/firebase-database.js"></script>
  <script defer src="/__/firebase/7.6.1/firebase-messaging.js"></script>
  <script defer src="/__/firebase/7.6.1/firebase-storage.js"></script>
  <script defer src="/__/firebase/7.6.1/firebase-firestore.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="/__/firebase/init.js"></script>
  
  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <!-- For popup? -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
  <!-- For pagination UI -->
  <script type="text/javascript" src="/js/jquery.simplePagination.js"></script>
  <link type="text/css" rel="stylesheet" href="/css/simplePagination.css"/>

  <!-- For accordion -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.10.2/css/all.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.10.2/css/v4-shims.css">

  <!-- YouTube sub counter -->
  <script src="https://apis.google.com/js/platform.js"></script>

  <!-- D3 for visualization -->
  <script src = "https://d3js.org/d3.v4.min.js"></script>


  <script src="js/addPlayer.js"></script>
  <script src="js/addProject.js"></script>
  <script src="js/addProject.js"></script>
  <script src="js/addPlayer.js"></script>
  <script src="js/authHelpers.js"></script>

  <link rel="stylesheet" href="css/pagination.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/auth.css">
  <link rel="stylesheet" href="css/select.css">
  <link rel="stylesheet" href="css/table.css">
  <link rel="stylesheet" href="css/shared.css">
  <link rel="stylesheet" href="css/responsive.css">

  <link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="manifest" href="icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <script type="text/javascript">
    window.userData = {}
    window.userVoteHistory = {} // Project name => list of voice ID
    window.onload = () => {
      const db = firebase.firestore()
      const user = firebase.auth().currentUser
      db.collection("projects").where("state", "==", "open")
        .get().then(querySnapshot => {
          querySnapshot.forEach(doc => {
            pData = doc.data()
            if(pData["available"].length > 0) {
              addProject(pData)
            }
          })
          $("#landing-spin").addClass("hide-loader");
        }
      )
    
      $(() => {
        $("#about-view").load("about.html"); 
        $("#stats-view").load("stats.html"); 
      });
      // Close modal when clicking outside
      $("#auth-form").click(ev => {
        if(ev.target != document.getElementById("auth-form")) {
          return;
        } else {
          $("#auth-form").hide();
        }
      });
      $("#about-view").click(ev => {
        if(ev.target != document.getElementById("about-view")) {
          return;
        } else {
          $("#about-view").hide();
        }
      });
      $("#stats-view").click(ev => {
        if(ev.target != document.getElementById("stats-view")) {
          return;
        } else {
          $("#stats-view").hide();
        }
      });

      firebase.auth().onAuthStateChanged(user => {
        if (user) {
          const db = firebase.firestore()
          db.collection('users').doc(user.uid).get().then(doc => {
            if(doc.exists) {
              window.userData = doc.data()
            }
          })
          $("#auth-button").html(`Account <i class="fa fa-user" />`)
          $("#auth-button").show()
        } else {
          $("#auth-button").html("Log in &bull; Sign up")
          $("#auth-button").show()
        }
        // FIXME: Cannot move the show() outside of the if
      });

      document.getElementById('signup-form').onsubmit = e => {
        e.preventDefault();
      }
      document.getElementById('login-form').onsubmit = e => {
        e.preventDefault();
      }
      document.getElementById('learn-more').onclick = e => {
        e.preventDefault();
        $("#about-view").show();
      }
      // document.getElementById('check-the-statistics').onclick = e => {
      //   e.preventDefault();
      //   $("#stats-view").show();
      // }
      document.getElementById('btn-stat').onclick = e => {
        e.preventDefault();
        $("#stats-view").show();
      }
    } // ^^^^^ onload ^^^^^
  </script>

</head>

<body>
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="nav-wrapper">
        <div class="container">
          <nav class="navbar navbar-expand-sm">
            <div id="logo" class="pull-left hidden-xs">
              <a href="javascript:window.location.href=window.location.href"><img src="/icons/logo_512.png" 
                  alt="Joytan App Forums" title="Joytan App Forums" width="30" height="30"></a>
            </div>
            <span class="form-inline my-2 my-lg-0 nav-item" id="auth-btn-wrapper">
              <button id="auth-button" class="btn btn-warning btn-slim" onclick="handleAuthButton()" 
                style="display: none;"></button>  
            </span>
            
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon">   
                <i class="fas fa-hamburger nav-hamburger"></i>
              </span>
            </button>
    
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                  <a class="nav-link" href="https://joytan.pub/forum">Forum <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="http://slack-invite.joytan.pub/">Join team</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://youtube.com/c/JoytanApp">YouTube</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Others +4
                  </a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <ul id="other-link-list">
                      <li>Android <a href="https://play.google.com/store/apps/details?id=com.joytan.rec" class="fa icon fa-android"></a></li>
                      <li>GitHub <a href="https://github.com/kokimame/joytan-public" class="fa icon fa-github"></a></li>
                      <li>Desktop <a href="https://kokimame.github.io/joytan/" class="fa icon fa-desktop"></a></li>
                      <li>Twitter <a href="https://twitter.com/JoytanApp" class="fa icon fa-twitter"></a></li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
      
      <div id="service-general" style="background-color: white">
        <div class="container">
          <h2 id="big-service-name">Joytan Public <span style="font-size: 70%;">üó£Ô∏è<a href="https://play.google.com/store/apps/details?id=com.joytan.rec">üì±</a>‚û°Ô∏èüì∫üé∂</span></h2>
          <p id="top-message">
            <b>Where we celebrate our special voice</b>. Review your voice and bring them to our YouTube channel.
            <a href="" id="learn-more">Learn more</a>
          </p>
          <a href="" id="check-the-statistics">Check the statisticsüìà</a>
          <div id="about-view" class="modal"></div>
          <div id="stats-view" class="modal"></div>

          <div id="auth-form" class="modal">
            <span onclick="closeModals()" class="close" title="Close Modal">&times;</span>
            <div class="modal-container">
              <div class="modal-contents container">
                <div id="signup-modal">
                  <form id="signup-form" method="post">
                    <h2>Sign Up</h2>
                    <p>Have an account? <a href="#/" onclick="signupLoginTransition('login')"><b>Log in!</b></a></p>
                    <hr>
                    <p>Please fill in this form to create an account.</p>
                    <label for="signup-email"><b>Email</b></label>
                    <input id="signup-email" class="auth-input" type="text" placeholder="Enter Email" name="signup-email"
                      pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="For example, [a-Z]@[a-Z].domain" required>
              
                    <label for="signup-psw"><b>Password</b></label>
                    <input id="signup-psw" class="auth-input" type="password" placeholder="Enter Password" name="signup-psw" onchange="validatePassword()"
                      minlength="8" maxlength="15" required>
              
                    <label for="confirm-password"><b>Repeat Password</b></label>
                    <input id="confirm-password" class="auth-input" type="password" placeholder="Repeat Password" name="psw-repeat" onkeyup="validatePassword()"
                    required>
      
                    <label for="signup-uname"><b>User name</b></label>
                    <input id="signup-uname" class="auth-input" type="text" placeholder="Enter your Username" name="signup-uname"
                      minlength="3" maxlength="32" required>
                    
                    <label>
                      <input type="checkbox" checked="checked" name="remember" style="margin-bottom:15px"> Remember me
                    </label>
                          
                    <div class="clearfix">
                      <button class="modal-button cancel-btn" type="button" onclick="closeModals()" >Cancel</button>
                      <button class="modal-button signup-btn btn-success" type="submit" onclick="createNewUser()">Sign Up</button>
                    </div>
                  </form>
                </div>
                <div id="login-modal">
                  <form id="login-form" method="post">
                    <h2>Log in</h2>
                    <p>Don't have an account? <a href="#/" onclick="signupLoginTransition('signup')"><b>Sign up!</b></a></p>
                    <hr>
                    <p>Please fill in this form to log in.</p>
                    <label for="email"><b>Email</b></label>
                    <input id="login-email" class="auth-input" type="text" placeholder="Enter Email" name="email"
                      pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="For example, [a-Z]@[a-Z].domain" required>
              
                    <label for="psw"><b>Password</b></label>
                    <input id="login-psw" class="auth-input" type="password" placeholder="Enter Password" name="psw" required
                      minlength="8" maxlength="15" required>
    
                    <label>
                      <input type="checkbox" checked="checked" name="remember" style="margin-bottom:15px"> Remember me
                    </label>
              
                    <div class="clearfix">
                      <button class="modal-button cancel-btn" type="button" onclick="closeModals()" >Cancel</button>
                      <button class="modal-button login-btn btn-success" type="submit" onclick="loginUser()">Log in</button>
                    </div>
                  </form>
                </div>
                <div id="account-modal">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div>
          <div class="project-category">
            <i class="fas fa-fire"></i> Ongoing
          </div>
        </div>
        <div class="accordion" id="projectsTop">
          <div id="landing-spin" class="spinner-wrapper">
            <i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>
          </div>
        </div>
      </div>
    </div>


    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyBr9SLxhKfyxzsbVmCVcn-J_QCgHQOqrOY",
        authDomain: "joytan-rec-16ba2.firebaseapp.com",
        databaseURL: "https://joytan-rec-16ba2.firebaseio.com",
        projectId: "joytan-rec-16ba2",
        storageBucket: "joytan-rec-16ba2.appspot.com",
        messagingSenderId: "950782104164",
        appId: "1:950782104164:web:adccd0fa64ae91ac"
      };
      firebase.initializeApp(firebaseConfig);
    </script>
</body>

</html>
