<html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Forum for Joytan App on YouTube</title>

<!-- update the version number as needed -->
<script defer src="/__/firebase/6.4.1/firebase-app.js"></script>
<!-- include only the Firebase features as you need -->
<script defer src="/__/firebase/6.4.1/firebase-auth.js"></script>
<script defer src="/__/firebase/6.4.1/firebase-database.js"></script>
<script defer src="/__/firebase/6.4.1/firebase-messaging.js"></script>
<script defer src="/__/firebase/6.4.1/firebase-storage.js"></script>
<!-- initialize the SDK after all desired features are loaded -->
<script defer src="/__/firebase/init.js"></script>

<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<!-- For popup? -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

<!-- For accordion -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.10.2/css/all.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.10.2/css/v4-shims.css">

<!-- YouTube sub counter -->
<script src="https://apis.google.com/js/platform.js"></script>

<link rel="apple-touch-icon" sizes="57x57" href="../icons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../icons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../icons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../icons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../icons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../icons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../icons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../icons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../icons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="../icons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="../icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="../icons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="../icons/favicon-16x16.png">
<link rel="manifest" href="../icons/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="../icons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="../css/main.css">
<link rel="stylesheet" href="../css/forum.css">
<script src="../js/addForum.js"></script>

<script>
function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
    });
    return vars;
}

window.onload = () => {
    const storage = firebase.storage();
    const storageRef = storage.ref();
    const topProjectsRef = storageRef.child('projects');
    const structureRef = storageRef.child('projects_structure.json');
    const projectName = getUrlVars()["p"];

    structureRef.getDownloadURL().then(url => {
        $.getJSON(url, (data) => {
            topProjectsRef.listAll().then(res => {
                res.prefixes.forEach(projectRef => {
                    if(projectRef.name == projectName) {
                        projData = data[projectName]
                        entries = projData["entries"]
                        wantedKey = projData["wanted"]
                        $("#title").text(projData["flags"] + projData["title"])

                        for (var i = 0; i < entries.length; i++){
                            addForum(entries[i], i.toString());
                        }
                    }
                })
            })
        })
    })
}
</script>

</head>
<body>
<div class="row justify-content-center">
    <div class="col-12">
        <div class="container">
            <h2>Welcome to "Forum for Joytan App on YouTube"</h2>
            <p id="title"></p>
            <div id="forum-accordion" class="accordion">
            </div>
        </div>
    </div>
</div>

<script>
    var firebaseConfig = {
        apiKey: "AIzaSyBr9SLxhKfyxzsbVmCVcn-J_QCgHQOqrOY",
        authDomain: "joytan-rec-16ba2.firebaseapp.com",
        databaseURL: "https://joytan-rec-16ba2.firebaseio.com",
        projectId: "joytan-rec-16ba2",
        storageBucket: "joytan-rec-16ba2.appspot.com",
        messagingSenderId: "950782104164",
        appId: "1:950782104164:web:adccd0fa64ae91ac"
    };
    firebase.initializeApp(firebaseConfig);
</script>

</body>

</html>